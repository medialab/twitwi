# =============================================================================
# Twitwi Utilities Unit Tests
# =============================================================================
from pytz import timezone
from twitwi.utils import get_dates, prepare_tweet

GET_DATES_TESTS = [
    (('Thu Feb 07 06:43:33 +0000 2013', 'Europe/Paris'), (1360219413, '2013-02-07T07:43:33')),
    (('Tue Nov 24 16:43:53 +0000 2020', 'Europe/Paris'), (1606236233, '2020-11-24T17:43:53')),
    (('Tue Nov 24 16:52:48 +0000 2020', 'Australia/Adelaide'), (1606236768, '2020-11-25T03:22:48'))
]

PREPARE_TWEET_TEST = [
    (
        {"created_at": "Fri Jan 29 16:29:05 +0000 2021", "id_str": "1355191242137743365", "text": "RT @NickKnudsenUS: Everyone: Biden won.\nGOP: He cheated!\nEveryone: Evidence?\nGOP: We said so.\nEveryone: That's not evidence.\nGOP: You're tr\u2026", "source": "<a href=\"http://twitter.com/download/android\" rel=\"nofollow\">Twitter for Android</a>", "truncated": False, "in_reply_to_status_id": None, "in_reply_to_status_id_str": None, "in_reply_to_user_id": None, "in_reply_to_user_id_str": None, "in_reply_to_screen_name": None, "user": {"id": 1350513055, "id_str": "1350513055", "name": "MsDreadNoMore\ud83c\udf0a\ud83c\uddfa\ud83c\uddf8 #Biden2020", "screen_name": "debmapmom2", "location": "Edmond, OK", "url": None, "description": "WEAR A FREAKING MASK! I am antifa!  \nI'd rather be hated for being myself than loved for who I'm not...Kurt Cobain \n#fbr #resist #BLM", "translator_type": "none", "protected": False, "verified": False, "followers_count": 4121, "friends_count": 4977, "listed_count": 5, "favourites_count": 72502, "statuses_count": 4418, "created_at": "Sat Apr 13 23:39:20 +0000 2013", "utc_offset": None, "time_zone": None, "geo_enabled": True, "lang": None, "contributors_enabled": False, "is_translator": False, "profile_background_color": "C0DEED", "profile_background_image_url": "http://abs.twimg.com/images/themes/theme1/bg.png", "profile_background_image_url_https": "https://abs.twimg.com/images/themes/theme1/bg.png", "profile_background_tile": False, "profile_link_color": "1DA1F2", "profile_sidebar_border_color": "C0DEED", "profile_sidebar_fill_color": "DDEEF6", "profile_text_color": "333333", "profile_use_background_image": True, "profile_image_url": "http://pbs.twimg.com/profile_images/1352483266943721475/Z4qPzA9T_normal.jpg", "profile_image_url_https": "https://pbs.twimg.com/profile_images/1352483266943721475/Z4qPzA9T_normal.jpg", "profile_banner_url": "https://pbs.twimg.com/profile_banners/1350513055/1611292161", "default_profile": True, "default_profile_image": False, "following": None, "follow_request_sent": None, "notifications": None}, "geo": None, "coordinates": None, "place": None, "contributors": None, "retweeted_status": {"created_at": "Fri Jan 29 06:54:36 +0000 2021", "id": 1355046668995977219, "id_str": "1355046668995977219", "text": "Everyone: Biden won.\nGOP: He cheated!\nEveryone: Evidence?\nGOP: We said so.\nEveryone: That's not evidence.\nGOP: You'\u2026 https://t.co/WDj7ABMVAb", "source": "<a href=\"https://mobile.twitter.com\" rel=\"nofollow\">Twitter Web App</a>", "truncated": True, "in_reply_to_status_id": None, "in_reply_to_status_id_str": None, "in_reply_to_user_id": None, "in_reply_to_user_id_str": None, "in_reply_to_screen_name": None, "user": {"id": 798953701972938752, "id_str": "798953701972938752", "name": "Nick Knudsen \ud83c\uddfa\ud83c\uddf8", "screen_name": "NickKnudsenUS", "location": "Portland, OR", "url": "http://www.demcastusa.com", "description": "Executive Director @DemCastUSA \ud83c\uddfa\ud83c\uddf8 Formerly: Editor-In-Chief, DemWritePress. Writing: @HuffPost @PatNotPart. We still have a lot of work to do. #DemCast", "translator_type": "none", "protected": False, "verified": False, "followers_count": 195281, "friends_count": 15570, "listed_count": 796, "favourites_count": 75320, "statuses_count": 65634, "created_at": "Wed Nov 16 18:19:41 +0000 2016", "utc_offset": None, "time_zone": None, "geo_enabled": False, "lang": None, "contributors_enabled": False, "is_translator": False, "profile_background_color": "000000", "profile_background_image_url": "http://abs.twimg.com/images/themes/theme1/bg.png", "profile_background_image_url_https": "https://abs.twimg.com/images/themes/theme1/bg.png", "profile_background_tile": False, "profile_link_color": "19CF86", "profile_sidebar_border_color": "000000", "profile_sidebar_fill_color": "000000", "profile_text_color": "000000", "profile_use_background_image": False, "profile_image_url": "http://pbs.twimg.com/profile_images/1252470219232014337/5mzgTlRw_normal.jpg", "profile_image_url_https": "https://pbs.twimg.com/profile_images/1252470219232014337/5mzgTlRw_normal.jpg", "profile_banner_url": "https://pbs.twimg.com/profile_banners/798953701972938752/1611643068", "default_profile": False, "default_profile_image": False, "following": None, "follow_request_sent": None, "notifications": None}, "geo": None, "coordinates": None, "place": None, "contributors": None, "is_quote_status": False, "extended_tweet": {"full_text": "Everyone: Biden won.\nGOP: He cheated!\nEveryone: Evidence?\nGOP: We said so.\nEveryone: That's not evidence.\nGOP: You're trying to steal the election!\nEveryone: That's *literally* what you're doing.\nGOP: We must revolt!\nCrazies: Revolt!\nEveryone: You're traitors.\nGOP: Don't be mean.", "display_text_range": [0, 280], "entities": {"hashtags": [], "urls": [], "user_mentions": [], "symbols": []}}, "quote_count": 397, "reply_count": 317, "retweet_count": 8297, "favorite_count": 33427, "entities": {"hashtags": [], "urls": [{"url": "https://t.co/WDj7ABMVAb", "expanded_url": "https://twitter.com/i/web/status/1355046668995977219", "display_url": "twitter.com/i/web/status/1\u2026", "indices": [117, 140]}], "user_mentions": [], "symbols": []}, "favorited": False, "retweeted": False, "filter_level": "low", "lang": "en"}, "is_quote_status": False, "quote_count": 0, "reply_count": 0, "retweet_count": 0, "favorite_count": 0, "entities": {"hashtags": [], "urls": [], "user_mentions": [{"screen_name": "NickKnudsenUS", "name": "Nick Knudsen \ud83c\uddfa\ud83c\uddf8", "id": 798953701972938752, "id_str": "798953701972938752", "indices": [3, 17]}], "symbols": []}, "favorited": False, "retweeted": False, "filter_level": "low", "lang": "en", "timestamp_ms": "1611937745018", "gazouilloire_source": "stream"},
        [{"_id": "1355046668995977219", "local_time": "2021-01-29T07:54:36", "timestamp_utc": 1611903276.0, "text": "Everyone: Biden won.\nGOP: He cheated!\nEveryone: Evidence?\nGOP: We said so.\nEveryone: That's not evidence.\nGOP: You're trying to steal the election!\nEveryone: That's *literally* what you're doing.\nGOP: We must revolt!\nCrazies: Revolt!\nEveryone: You're traitors.\nGOP: Don't be mean.", "url": "https://twitter.com/NickKnudsenUS/statuses/1355046668995977219", "quoted_id": None, "quoted_user": None, "quoted_user_id": None, "quoted_timestamp_utc": None, "retweeted_id": None, "retweeted_user": None, "retweeted_user_id": None, "retweeted_timestamp_utc": None, "media_files": [], "media_types": [], "media_urls": [], "links": [], "links_to_resolve": False, "hashtags": [], "mentioned_ids": [], "mentioned_names": [], "collection_time": "2021-01-29T17:29:10.218648", "collected_via": ["retweet"], "match_query": True, "to_tweetid": None, "to_username": None, "to_userid": None, "lang": "en", "coordinates": None, "retweet_count": 8297, "like_count": 33427, "reply_count": 317, "user_id": "798953701972938752", "user_screen_name": "NickKnudsenUS", "user_name": "Nick Knudsen \ud83c\uddfa\ud83c\uddf8", "user_friends": 15570, "user_followers": 195281, "user_location": "Portland, OR", "user_verified": False, "user_description": "Executive Director @DemCastUSA \ud83c\uddfa\ud83c\uddf8 Formerly: Editor-In-Chief, DemWritePress. Writing: @HuffPost @PatNotPart. We still have a lot of work to do. #DemCast", "user_created_at": "2016-11-16T19:19:41", "user_tweets": 65634, "user_likes": 75320, "user_lists": 796, "user_image": "https://pbs.twimg.com/profile_images/1252470219232014337/5mzgTlRw_normal.jpg", "user_url": "http://www.demcastusa.com", "user_timestamp_utc": 1479320381.0, "source_url": "https://mobile.twitter.com", "source_name": "Twitter Web App"}]
    ),
    (
        {"created_at": "Fri Jan 29 06:54:36 +0000 2021", "id_str": "1355046668995977219", "text": "Everyone: Biden won.\nGOP: He cheated!\nEveryone: Evidence?\nGOP: We said so.\nEveryone: That's not evidence.\nGOP: You'\u2026 https://t.co/WDj7ABMVAb", "source": "<a href=\"https://mobile.twitter.com\" rel=\"nofollow\">Twitter Web App</a>", "truncated": True, "in_reply_to_status_id": None, "in_reply_to_status_id_str": None, "in_reply_to_user_id": None, "in_reply_to_user_id_str": None, "in_reply_to_screen_name": None, "user": {"id": 798953701972938752, "id_str": "798953701972938752", "name": "Nick Knudsen \ud83c\uddfa\ud83c\uddf8", "screen_name": "NickKnudsenUS", "location": "Portland, OR", "url": "http://www.demcastusa.com", "description": "Executive Director @DemCastUSA \ud83c\uddfa\ud83c\uddf8 Formerly: Editor-In-Chief, DemWritePress. Writing: @HuffPost @PatNotPart. We still have a lot of work to do. #DemCast", "translator_type": "none", "protected": False, "verified": False, "followers_count": 195281, "friends_count": 15570, "listed_count": 796, "favourites_count": 75320, "statuses_count": 65634, "created_at": "Wed Nov 16 18:19:41 +0000 2016", "utc_offset": None, "time_zone": None, "geo_enabled": False, "lang": None, "contributors_enabled": False, "is_translator": False, "profile_background_color": "000000", "profile_background_image_url": "http://abs.twimg.com/images/themes/theme1/bg.png", "profile_background_image_url_https": "https://abs.twimg.com/images/themes/theme1/bg.png", "profile_background_tile": False, "profile_link_color": "19CF86", "profile_sidebar_border_color": "000000", "profile_sidebar_fill_color": "000000", "profile_text_color": "000000", "profile_use_background_image": False, "profile_image_url": "http://pbs.twimg.com/profile_images/1252470219232014337/5mzgTlRw_normal.jpg", "profile_image_url_https": "https://pbs.twimg.com/profile_images/1252470219232014337/5mzgTlRw_normal.jpg", "profile_banner_url": "https://pbs.twimg.com/profile_banners/798953701972938752/1611643068", "default_profile": False, "default_profile_image": False, "following": None, "follow_request_sent": None, "notifications": None}, "geo": None, "coordinates": None, "place": None, "contributors": None, "is_quote_status": False, "extended_tweet": {"full_text": "Everyone: Biden won.\nGOP: He cheated!\nEveryone: Evidence?\nGOP: We said so.\nEveryone: That's not evidence.\nGOP: You're trying to steal the election!\nEveryone: That's *literally* what you're doing.\nGOP: We must revolt!\nCrazies: Revolt!\nEveryone: You're traitors.\nGOP: Don't be mean.", "display_text_range": [0, 280], "entities": {"hashtags": [], "urls": [], "user_mentions": [], "symbols": []}}, "quote_count": 397, "reply_count": 317, "retweet_count": 8297, "favorite_count": 33427, "entities": {"hashtags": [], "urls": [{"url": "https://t.co/WDj7ABMVAb", "expanded_url": "https://twitter.com/i/web/status/1355046668995977219", "display_url": "twitter.com/i/web/status/1\u2026", "indices": [117, 140]}], "user_mentions": [], "symbols": []}, "favorited": False, "retweeted": False, "filter_level": "low", "lang": "en", "gazouilloire_source": "retweet"},
        [{"_id": "1355046668995977219", "local_time": "2021-01-29T07:54:36", "timestamp_utc": 1611903276.0, "text": "Everyone: Biden won.\nGOP: He cheated!\nEveryone: Evidence?\nGOP: We said so.\nEveryone: That's not evidence.\nGOP: You're trying to steal the election!\nEveryone: That's *literally* what you're doing.\nGOP: We must revolt!\nCrazies: Revolt!\nEveryone: You're traitors.\nGOP: Don't be mean.", "url": "https://twitter.com/NickKnudsenUS/statuses/1355046668995977219", "quoted_id": None, "quoted_user": None, "quoted_user_id": None, "quoted_timestamp_utc": None, "retweeted_id": None, "retweeted_user": None, "retweeted_user_id": None, "retweeted_timestamp_utc": None, "media_files": [], "media_types": [], "media_urls": [], "links": [], "links_to_resolve": False, "hashtags": [], "mentioned_ids": [], "mentioned_names": [], "collection_time": "2021-01-29T17:29:10.218648", "collected_via": ["retweet"], "match_query": True, "to_tweetid": None, "to_username": None, "to_userid": None, "lang": "en", "coordinates": None, "retweet_count": 8297, "like_count": 33427, "reply_count": 317, "user_id": "798953701972938752", "user_screen_name": "NickKnudsenUS", "user_name": "Nick Knudsen \ud83c\uddfa\ud83c\uddf8", "user_friends": 15570, "user_followers": 195281, "user_location": "Portland, OR", "user_verified": False, "user_description": "Executive Director @DemCastUSA \ud83c\uddfa\ud83c\uddf8 Formerly: Editor-In-Chief, DemWritePress. Writing: @HuffPost @PatNotPart. We still have a lot of work to do. #DemCast", "user_created_at": "2016-11-16T19:19:41", "user_tweets": 65634, "user_likes": 75320, "user_lists": 796, "user_image": "https://pbs.twimg.com/profile_images/1252470219232014337/5mzgTlRw_normal.jpg", "user_url": "http://www.demcastusa.com", "user_timestamp_utc": 1479320381.0, "source_url": "https://mobile.twitter.com", "source_name": "Twitter Web App"}, {"_id": "1355191242137743365", "local_time": "2021-01-29T17:29:05", "timestamp_utc": "1611937745.0", "text": "RT @NickKnudsenUS: Everyone: Biden won.\nGOP: He cheated!\nEveryone: Evidence?\nGOP: We said so.\nEveryone: That's not evidence.\nGOP: You're trying to steal the election!\nEveryone: That's *literally* what you're doing.\nGOP: We must revolt!\nCrazies: Revolt!\nEveryone: You're traitors.\nGOP: Don't be mean.", "url": "https://twitter.com/debmapmom2/statuses/1355191242137743365", "quoted_id": None, "quoted_user": None, "quoted_user_id": None, "quoted_timestamp_utc": None, "retweeted_id": "1355046668995977219", "retweeted_user": "NickKnudsenUS", "retweeted_user_id": "798953701972938752", "retweeted_timestamp_utc": "1611903276.0", "media_files": [], "media_types": [], "media_urls": [], "links": [], "links_to_resolve": False, "hashtags": [], "mentioned_ids": ["798953701972938752"], "mentioned_names": ["nickknudsenus"], "collection_time": "2021-01-29T17:29:10.220398", "collected_via": ["stream"], "match_query": True, "to_tweetid": None, "to_username": None, "to_userid": None, "lang": "en", "coordinates": None, "retweet_count": 0, "like_count": 0, "reply_count": 0, "user_id": "1350513055", "user_screen_name": "debmapmom2", "user_name": "MsDreadNoMore\ud83c\udf0a\ud83c\uddfa\ud83c\uddf8 #Biden2020", "user_friends": 4977, "user_followers": 4121, "user_location": "Edmond, OK", "user_verified": False, "user_description": "WEAR A FREAKING MASK! I am antifa!  \nI'd rather be hated for being myself than loved for who I'm not...Kurt Cobain \n#fbr #resist #BLM", "user_created_at": "2013-04-14T01:39:20", "user_tweets": 4418, "user_likes": 72502, "user_lists": 5, "user_image": "https://pbs.twimg.com/profile_images/1352483266943721475/Z4qPzA9T_normal.jpg", "user_url": None, "user_timestamp_utc": "1365896360.0", "source_url": "http://twitter.com/download/android", "source_name": "Twitter for Android"}]

    )

]


class TestUtils(object):
    def test_get_dates(self):
        for (date_str, tz), result in GET_DATES_TESTS:
            tz = timezone(tz)

            assert get_dates(date_str, locale=tz) == result, (date_str, tz)

    def test_prepare_tweet(self):
        tz = timezone("Europe/Paris")
        for tweet, correct_result in PREPARE_TWEET_TEST:
            result = prepare_tweet(tweet, locale=tz)
            for sub_tweet, sub_tweet_correct in zip(result, correct_result):
                for key in sub_tweet_correct:
                    if key != "collection_time":
                        assert sub_tweet[key] == sub_tweet_correct[key]
